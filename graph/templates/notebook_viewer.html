{% extends 'base.html' %}

{% block extra_head %}
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://d3js.org/d3.geo.projection.v0.min.js" charset="utf-8"></script>
    <script src="http://trifacta.github.com/vega/vega.js"></script>
{% endblock extra_head %}

{% block content %}
    <div class="row">
        <form class="form-inline" role="form">
        <div class="col-md-4 form-group ui-widget">
            <label for="notebook">Notebook:</label><input type="text" name="notebook" class="form-control" id="id_notebook" value="example">
        </div>
        <div class="col-md-4 form-group ui-widget">
            <label for="var">Variable:</label><input type="text" class="form-control" name="var" id="id_var" value="line">
        </div>
        <div class="col-md-2 form-group ui-widget">
            <button type="button" id="id_update" class="btn btn-primary">Update</button>
        </div>
        </form>
    </div>
    <div class="row">
        <div id="vis"></div>
    </div>
{% endblock content %}

{% block scripts %}
<script type="text/javascript">
// parse a spec and create a visualization view
function parse(spec) {
  vg.parse.spec(spec, function(chart) { chart({el:"#vis"}).update(); });
}
//parse("None");
function update() {
    $.get("/api/nb/" + $("#id_notebook").val().trim() + "/" + $("#id_var").val().trim() + "/", function(data) {
        parse(data);
    });
}

$(function() {
    $("#id_update").click(function(event) {
        update();
    });
    update();
    $("#id_notebook").autocomplete({
        source: "/api/nb/",
        minLength: 0,
        select: function(event, ui) {
            $("#id_var").autocomplete({
                source: "/api/nb/" + this.value,
                minLength: 0,
                select: function(event, ui) {
                    update();
                }
            });
        }
    });
});
</script>
{% endblock scripts %}
